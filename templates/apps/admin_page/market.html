{% extends 'apps/base.html' %}
{% load category_tags %}

{% block base %}
    <style>
        .product-card {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            height: 100%; /* Ensure cards have the same height */
            text-align: center; /* Center text for uniformity */
        }

        .product-card img {
            height: 265px; /* Height for larger screens */
            object-fit: cover; /* Maintain aspect ratio */
        }

        .product-card:hover {
            transform: scale(1.03); /* Scale effect on hover */
        }

        /* Responsive adjustments for product cards */
        @media (max-width: 768px) {
            .product-card {
                padding: 8px; /* Reduce padding for smaller screens */
            }

            .product-card img {
                height: 120px; /* Further reduce image height for medium screens */
            }

            .product-card .card-title {
                font-size: 0.9rem; /* Smaller font size for titles */
            }

            .product-card h5 {
                font-size: 0.75rem; /* Smaller font size for price */
            }
        }

        @media (max-width: 480px) {
            .product-card {
                padding: 4px; /* Minimal padding */
            }

            .product-card img {
                height: 115px; /* Minimal image height for very small screens */
                width: 107px; /* Maintain width for very small screens */
            }

            .product-card .card-title {
                font-size: 0.75rem; /* Maintain smaller title font */
            }

            .product-card h5 {
                font-size: 0.6rem; /* Further reduce price font size */
            }

            /* Adjust button sizes for small screens */
            .btn {
                font-size: 0.6rem; /* Smaller font size */
                padding: 3px 6px; /* Smaller padding */
            }
        }
    </style>

    <div class="card mb-3">
        <div class="card-body">
            <div class="row gx-4"> <!-- Added horizontal gutter spacing -->
                {% for product in products %}
                    <div class="col-6 col-sm-6 col-md-4 mb-4"> <!-- Adjusted margins -->
                        <div class="product-card">
                            <a href="{% url 'product_detail' product.slug %}" target="_blank">
                                <img class="card-img-top" src="{{ product.image.url }}" alt="{{ product.name }}">
                            </a>
                            <div class="card-body">
                                <h4 class="card-title">
                                    <a href="{% url 'product_detail' product.slug %}" target="_blank">
                                        {{ product.name }}
                                    </a>
                                </h4>
                                <h5 style="color: red">{{ product.price }} so'm</h5>
                            </div>

                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">To'lov: <strong>{{ product.payment_referral }}</strong></li>
                                <li class="list-group-item">Zaxirada: <strong>{{ product.quantity }} ta</strong></li>
                                <li class="list-group-item">Chegirma:
                                    <strong>{{ product.discount_market|default:"yo'q" }}</strong>
                                </li>
                            </ul>

                            <a href="https://t.me/onlinebozor1000xil/" class="btn text-white mt-2"
                               style="background-color: red">Postlar</a>
                            <button class="btn btn-primary btn_open_modal" type="button" data-bs-toggle="modal"
                                    data-bs-target="#exampleModal" style="background-color: midnightblue"
                                    name="{{ product.id }}">
                                Oqim yaratish
                            </button>
                            <a href="{% url 'product_statistics' product.pk %}" class="btn text-white mt-2"
                               style="background-color: red">Batafsil</a>
                        </div>
                    </div>
                {% endfor %}

                {% include 'apps/pagination.html' %}
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll('.btn_open_modal').forEach(button => {
            button.addEventListener('click', function () {
                let product_id = this.getAttribute('name');
                console.log("Tugma bosildi, mahsulot ID:", product_id);
                document.getElementById('hidden_product').value = product_id;
            });
        });
    </script>
{% endblock %}
